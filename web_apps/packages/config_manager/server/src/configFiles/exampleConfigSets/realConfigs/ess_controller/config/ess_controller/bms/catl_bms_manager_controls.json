{    
    "/schedule/wake_monitor/bms":{
        "/controls/bms:OpenContactorsEnable":     { "enable": true, "amap": "bms", "func": "CalculateVar"},
        "/controls/bms:CloseContactorsEnable":    { "enable": true, "amap": "bms", "func": "CalculateVar"},
        "/controls/bms:CloseContactors":          { "enable": true, "amap": "bms", "func": "HandleCmd"},
        "/controls/bms:OpenContactors":           { "enable": true, "amap": "bms", "func": "HandleCmd"},
        "/controls/bms:ClearFaults":              { "enable": true, "amap": "bms", "func": "HandleCmd"},
        "/controls/bms:VerifyContactorsClosed":   { "enable": true, "amap": "bms", "func": "HandleCmd"},
        "/controls/bms:VerifyContactorsOpened":   { "enable": true, "amap": "bms", "func": "HandleCmd"}
    },
    "/controls/bms": {
        "OpenContactorsEnable": {
            "value": 0,
            "useExpr": true,
            "numVars": 4,
            "variable1": "/status/bms:DCClosed",
            "variable2": "/status/pcs:DCClosed",
            "variable3": "/assets/bms/##BMS_ID##:maint_mode",
            "variable4": "/status/bms:OffFault",
            "expression": "({1} or {4}) and not {2} and {3}",
            "actions": {
                "onSet": [{
                    "remap": [
                        {"inValue":0, "uri":"/assets/bms/##BMS_ID##:stop@enabled", "outValue":false},
                        {"inValue":1, "uri":"/assets/bms/##BMS_ID##:stop@enabled", "outValue":true},

                        {"inValue":0, "uri":"/master/##ESS_ID##_ls:bms_open_contactors_enabled", "outValue":false},
                        {"inValue":1, "uri":"/master/##ESS_ID##_ls:bms_open_contactors_enabled", "outValue":true}
                    ]
                }]
            }
        },
        "CloseContactorsEnable": {
            "value": 0,
            "useExpr": true,
            "numVars": 3,
            "variable1": "/status/bms:DCClosed",
            "variable2": "/assets/bms/##BMS_ID##:maint_mode",
            "variable3": "/status/bms:OffFault",
            "expression": "(not {1} or {3}) and {2}",
            "actions": {
                "onSet": [{
                    "remap": [
                        {"inValue":0, "uri":"/assets/bms/##BMS_ID##:start@enabled", "outValue":false},
                        {"inValue":1, "uri":"/assets/bms/##BMS_ID##:start@enabled", "outValue":true},

                        {"inValue":0, "uri":"/master/##ESS_ID##_ls:bms_close_contactors_enabled", "outValue":false},
                        {"inValue":1, "uri":"/master/##ESS_ID##_ls:bms_close_contactors_enabled", "outValue":true}
                    ]
                }]
            }
        },
        "CloseContactors": {
            "value": 2,
            "note": "Close DC contactors command to send to BMS if the BMS is off ready (meaning DC contactors are open) and the PCS is either off or faulted",
            "cmdVar": "/components/catl_##BMS_ID##_controls:ems_cmd",
            "checkCmdTimeout": 30,
            "sendCmdTimeout": 2,
            "numVars": 3,
            "variable1": "/status/bms:DCClosed",
            "variable2": "/status/pcs:SystemState",
            "variable3": "/status/bms:IsFaulted",
            "useExpr": true,
            "expression": "{1} == 0 and ({2} == Off or {2} == Fault or {2} == Starting) and not {3}",
            "actions": {
                "onSet": [{"func": [{"func": "HandleCmd", "amap": "bms"}]}]
            }
        },
        "OpenContactors": {
            "value": 3,
            "note": "Open DC contactors command to send to BMS if the BMS is on ready (meaning DC contactors are closed) and the PCS is either off or faulted",
            "cmdVar": "/components/catl_##BMS_ID##_controls:ems_cmd",
            "checkCmdTimeout": 30,
            "sendCmdTimeout": 2,
            "numVars": 2,
            "variable1": "/status/bms:DCClosed",
            "variable2": "/status/pcs:SystemState",
            "useExpr": true,
            "expression": "{1} == 1 and ({2} == Off or {2} == Fault)",
            "actions": {
                "onSet": [{"func": [{"func": "HandleCmd", "amap": "bms"}]}]
            }
        },
        "ClearFaults": {
            "value": 1,
            "note": "Clear faults command to send to BMS",
            "cmdVar": "/components/catl_##BMS_ID##_controls:fault_clear_cmd",
            "checkCmdTimeout": 30,
            "actions": {
                "onSet": [{"func": [{"func": "HandleCmd", "amap": "bms"}]}]
            }
        },
        "VerifyContactorsClosed": {
            "value": 0,
            "note": "Verify that the BMS system state is now on ready (meaning DC contactors are closed) when the close contactors command is sent",
            "enableAlert": false,
            "sendCmdHoldTimeout": 3,
            "sendCmdTimeout": 2,
            "numVars": 1,
            "variable1": "/status/bms:DCClosed",
            "useExpr": true,
            "expression": "{1} == 1",
            "actions": {
                "onSet": [{"func": [{"func": "HandleCmd", "amap": "bms"}]}]
            }
        },
        "VerifyContactorsOpened": {
            "value": 0,
            "note": "Verify that the BMS system state is now off ready (meaning DC contactors are open) when the open contactors command is sent",
            "enableAlert": false,
            "sendCmdHoldTimeout": 3,
            "sendCmdTimeout": 2,
            "numVars": 1,
            "variable1": "/status/bms:DCClosed",
            "useExpr": true,
            "expression": "{1} == 0",
            "actions": {
                "onSet": [{"func": [{"func": "HandleCmd", "amap": "bms"}]}]
            }
        }
    },
    "/status/bms": {
        "CloseContactorsSuccess": {
            "value": false,
            "note": "If the close contactors command has been successfully sent to the BMS, verify that the BMS DC contactors have been closed. Otherwise, send an alarm",
            "actions": {
                "onSet": [{
                    "remap": [
                        {"inValue": true,  "ifChanged": false, "uri": "/controls/bms:VerifyContactorsClosed@triggerCmd", "outValue": true},
                        {"inValue": true,  "ifChanged": false, "uri": "/controls/bms:VerifyContactorsClosed",            "outValue": 0},

                        {"inValue": false, "ifChanged": false, "uri": "/alarms/bms:close_contactors_cmd",                "outValue": "Failed to send/verify close contactors command (1) to BMS"}
                    ]
                }]
            }
        },
        "OpenContactorsSuccess": {
            "value": false,
            "note": "If the open contactors command has been successfully sent to the BMS, verify that the BMS DC contactors have been opened. Otherwise, send an alarm",
            "actions": {
                "onSet": [{
                    "remap": [
                        {"inValue": true,  "ifChanged": false, "uri": "/controls/bms:VerifyContactorsOpened@triggerCmd", "outValue": true},
                        {"inValue": true,  "ifChanged": false, "uri": "/controls/bms:VerifyContactorsOpened",            "outValue": 0},

                        {"inValue": false, "ifChanged": false, "uri": "/alarms/bms:open_contactors_cmd",                 "outValue": "Failed to send/verify open contactors command (2) to BMS"}
                    ]
                }]
            }
        },
        "ClearFaultsSuccess": {
            "value": false,
            "note": "Send an alarm if the clear faults command was not sent to the BMS. Regardless of whether the command is sent or not, clear the faults/alarms currently recorded in ESS Controller",
            "actions": {
                "onSet": [{
                    "remap": [
                        {"inValue": false, "ifChanged": false, "uri": "/alarms/bms:clear_faults_cmd", "outValue": "Failed to send/verify clear faults command (1) to BMS"},
                        {"uri": "/status/bms:SystemFaultCleared", "outValue": true}
                    ]
                }]
            }
        },
        "VerifyContactorsClosedSuccess": {
            "value": false,
            "note": "If the BMS failed to close contactors after an elasped time, send an alarm",
            "actions": {
                "onSet": [{
                    "remap": [
                        {"inValue": false, "ifChanged": false, "uri": "/alarms/bms:close_contactors_failure", "outValue": "Failed to close contactors for BMS"}
                    ]
                }]
            }
        },
        "VerifyContactorsOpenedSuccess": {
            "value": false,
            "note": "If the BMS failed to open contactors after an elasped time, send an alarm",
            "actions": {
                "onSet": [{
                    "remap": [
                        {"inValue": false, "ifChanged": false, "uri": "/alarms/bms:open_contactors_failure", "outValue": "Failed to open contactors for BMS"}
                    ]
                }]
            }
        }
    }
}