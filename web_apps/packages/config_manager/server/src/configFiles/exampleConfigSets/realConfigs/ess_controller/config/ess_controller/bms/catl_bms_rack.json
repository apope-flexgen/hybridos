{
    "/doc/10_##RACK_ID##": {
        "note1":"This is the bms component config template for CATL subsystems.",
        "note1a":"The bms page of the ui display is outlined in /assets/##BMS_ID##/summay",
        "note1b":"The /assets/##BMS_ID##/##RACK_ID## table defines the racks or battery management unit, each has a template file with placements for selected key words",
        "note2": "The /config/bms area is still under development",
        "note3":"The `/components/catl_##BMS_ID##... tables define the incoming control words from the bms modbus interface",
        "note4":"The /links/<bms> table  defines mapping of external interface components to internal control variables",
        "note5":"There are some junk/test fields as well... they will removed soon"
    },
    "/system/##RACK_ID##": {
        "id": "##RACK_ID##",
        "name": "BMS Battery  Block ##BMS_NUM##"
    },
    "/config/##RACK_ID##": {
        "AlarmDestination": "/assets/##BMS_ID##/##RACK_ID##:alarms",
        "FaultDestination": "/assets/##BMS_ID##/##RACK_ID##:faults",
        "NoFaultMsg": "Normal",
        "NoAlarmMsg": "Normal"
    },
    "/assets/##BMS_ID##/##RACK_ID##": {
        "name": "Battery Rack ##BMS_NUM##",
        "alarms":                     {"name": "Alarms",                       "value": 0,     "enabled": true, "options": []},
        "faults":                     {"name": "Faults",                       "value": 0,     "enabled": true, "options": []},
        "system_state":               {"name": "Battery Status",               "value": "N/A", "enabled": true},
        "charge_discharge_state":     {"name": "Charge/Discharge Status",      "value": "N/A", "enabled": true},
        "dc_contactor_status":        {"name": "Contactor Status",             "value": "Open","enabled": true},
        "enable_status":              {"name": "Enable Status",                "value": "N/A", "enabled": true},
        "soc":                        {"name": "State of Charge",              "value": 0,     "enabled": true},
        "soh":                        {"name": "State of Health",              "value": 0,     "enabled": true},
        "system_voltage":             {"name": "System Voltage",               "value": 0,     "enabled": true},
        "system_current":             {"name": "System Current",               "value": 0,     "enabled": true},
        "system_power":               {"name": "System Power",                 "value": 0,     "enabled": true},
        "max_cell_voltage":           {"name": "Max Cell Voltage",             "value": 0,     "enabled": true},
        "min_cell_voltage":           {"name": "Min Cell Voltage",             "value": 0,     "enabled": true},
        "avg_cell_voltage":           {"name": "Avg Cell Voltage",             "value": 0,     "enabled": true},
        "max_cell_temp":              {"name": "Max Cell Temperature",         "value": 0,     "enabled": true},
        "min_cell_temp":              {"name": "Min Cell Temperature",         "value": 0,     "enabled": true},
        "avg_cell_temp":              {"name": "Avg Cell Temperature",         "value": 0,     "enabled": true},
        "max_charge_current":         {"name": "Max Charge Current Allowed",   "value": 0,     "enabled": true},
        "max_discharge_current":      {"name": "Max Discharge Current Allowed","value": 0,     "enabled": true},
        "door_state":                 {"name": "Door State",                   "value": "Off", "enabled": true},
        "maint_mode": {
            "name": "Maintenance Mode",
            "value": false,
            "enabled": true,
            "actions": {
                "onSet": [{
                    "remap": [
                        {"uri":	"/assets/##BMS_ID##/##RACK_ID##:clear_faults@enabled"}
                    ]
                }]
            },
            "options": [
                {"name": "No","return_value": false},
                {"name": "Yes","return_value": true}
            ]
        },
        "clear_faults": {
            "name": "Clear Faults",
            "value": false,
            "enabled": false,
            "actions": { 
                "onSet":[{
                    "func": [
                        {"ifChanged": false, "func": "LogInfo", "amap": "##ESS_ID##"}
                    ],
                    "remap":[
                        {"ifChanged": false, "outValue":"Clear","uri":"/faults/##RACK_ID##:clear_faults"},
                        {"ifChanged": false, "outValue":"Clear","uri":"/alarms/##RACK_ID##:clear_alarms"},

                        {"ifChanged": false, "outValue":0,"uri":"/master/##ESS_ID##_ls:##RACK_ID##_alarms"},
                        {"ifChanged": false, "outValue":0,"uri":"/master/##ESS_ID##_ls:##RACK_ID##_faults"}
                    ]
                }]
            },
            "options": [
                {
                    "name": "Clear Faults",
                    "return_value": "Clear"
                }
            ]
        }
    },
    "/schedule/wake_monitor/##RACK_ID##":{
        "/status/##RACK_ID##:Power":              { "enable": true, "amap": "##RACK_ID##", "func":"CalculateVar"},
        "/status/##RACK_ID##:DCClosed":           { "enable": true, "amap": "##RACK_ID##", "func":"CalculateVar"},
        "/status/##RACK_ID##:PoweredOn":          { "enable": true, "amap": "##RACK_ID##", "func":"CalculateVar"}
    },
    "/system/commands": {
        "runRackOpts": {
            "value": false,
            "enabled": false,
            "targav": "/system/commands:run",
            "options": [
                {"uri":"/sched/##RACK_ID##:pubAssets_##RACK_ID##",  "aname":"##RACK_ID##", "value":0, "every":1},
                {"uri":"/sched/##RACK_ID##:runMonitor_##RACK_ID##", "aname":"##RACK_ID##", "value":0, "every":0.1}
            ],
            "actions": {
                "onSet":[{"func":[{"amap": "##RACK_ID##", "func":"SchedItemOpts"}]}]
            }
        }
    },

    "/sched/##RACK_ID##": {
        "pubAssets_##RACK_ID##": {
            "value": 0,
            "enable": "/config/bms:enable",
            "mode": "ui",
            "table": "/assets/##BMS_ID##/##RACK_ID##",
            "actions": {
                "onSet":[{"func":[{"amap": "##RACK_ID##", "func":"RunPub"}]}]
            }
        },
        "runMonitor_##RACK_ID##":{
            "value":1,
            "enable": "/config/bms:enable",
            "monitor":"wake_monitor",
            "aname":"##RACK_ID##",
            "actions":{
                "onSet":[{"func":[{"amap": "##RACK_ID##", "func":"RunMonitor"}]}]
            }
        }
    },

    "/vlinks/##RACK_ID##": {
        "##RACK_ID##_soc_ui":                   { "value": "/assets/##BMS_ID##/##RACK_ID##:soc",                   "vlink": "/status/##RACK_ID##:SOC"                   },
        "##RACK_ID##_soh_ui":                   { "value": "/assets/##BMS_ID##/##RACK_ID##:soh",                   "vlink": "/status/##RACK_ID##:SOH"                   },
        "##RACK_ID##_voltage_ui":               { "value": "/assets/##BMS_ID##/##RACK_ID##:system_voltage",        "vlink": "/status/##RACK_ID##:Voltage"               },
        "##RACK_ID##_current_ui":               { "value": "/assets/##BMS_ID##/##RACK_ID##:system_current",        "vlink": "/status/##RACK_ID##:Current"               },
        "##RACK_ID##_power_ui":                 { "value": "/assets/##BMS_ID##/##RACK_ID##:system_power",          "vlink": "/status/##RACK_ID##:Power"                 },
        "##RACK_ID##_max_cell_voltage_ui":      { "value": "/assets/##BMS_ID##/##RACK_ID##:max_cell_voltage",      "vlink": "/status/##RACK_ID##:MaxCellVoltage"        },
        "##RACK_ID##_min_cell_voltage_ui":      { "value": "/assets/##BMS_ID##/##RACK_ID##:min_cell_voltage",      "vlink": "/status/##RACK_ID##:MinCellVoltage"        },
        "##RACK_ID##_avg_cell_voltage_ui":      { "value": "/assets/##BMS_ID##/##RACK_ID##:avg_cell_voltage",      "vlink": "/status/##RACK_ID##:AvgCellVoltage"        },
        "##RACK_ID##_max_cell_temp_ui":         { "value": "/assets/##BMS_ID##/##RACK_ID##:max_cell_temp",         "vlink": "/status/##RACK_ID##:MaxCellTemp"           },
        "##RACK_ID##_min_cell_temp_ui":         { "value": "/assets/##BMS_ID##/##RACK_ID##:min_cell_temp",         "vlink": "/status/##RACK_ID##:MinCellTemp"           },
        "##RACK_ID##_avg_cell_temp_ui":         { "value": "/assets/##BMS_ID##/##RACK_ID##:avg_cell_temp",         "vlink": "/status/##RACK_ID##:AvgCellTemp"           },
        "##RACK_ID##_max_charge_current_ui":    { "value": "/assets/##BMS_ID##/##RACK_ID##:max_charge_current",    "vlink": "/limits/##RACK_ID##:ChargeCurrentLimit"    },
        "##RACK_ID##_max_discharge_current_ui": { "value": "/assets/##BMS_ID##/##RACK_ID##:max_discharge_current", "vlink": "/limits/##RACK_ID##:DischargeCurrentLimit" }
    },

    "/status/##RACK_ID##": {
        "Voltage": 0,
        "Current": 0,
        "Power": {
            "value": 0,
            "numVars": 2,
            "variable1": "/status/##RACK_ID##:Voltage",
            "variable2": "/status/##RACK_ID##:Current",
            "scale": 1000,
            "operation": "*"
        },
        "DCClosedP": 0,
        "DCClosedN": 0,
        "DCClosed": {
            "value": 0,
            "resetChange": false,
            "useExpr": true,
            "numVars": 2,
            "variable1": "/status/##RACK_ID##:DCClosedP",
            "variable2": "/status/##RACK_ID##:DCClosedN",
            "expression": "{1} and {2}",
            "actions": { 
                "onSet":[{
                    "remap":[
                        {"inValue": 0, "uri":"/status/##RACK_ID##:Current@EnableMaxValCheck", "outValue": false},
                        {"inValue": 1, "uri":"/status/##RACK_ID##:Current@EnableMaxValCheck", "outValue": true},
                        {"inValue": 0, "uri":"/status/##RACK_ID##:Current@EnableMinValCheck", "outValue": false},
                        {"inValue": 1, "uri":"/status/##RACK_ID##:Current@EnableMinValCheck", "outValue": true},

                        {"inValue": 0, "uri":"/assets/##BMS_ID##/##RACK_ID##:dc_contactor_status", "outValue": "Open"},
                        {"inValue": 1, "uri":"/assets/##BMS_ID##/##RACK_ID##:dc_contactor_status", "outValue": "Closed"}
                    ]
                }]
            }
        },
        "FaultCnt": 0,
        "AlarmCnt": 0,
        "AvgCellVoltage": 0,
        "PoweredOn": {
            "value": 0,
            "useExpr": true,
            "numVars": 1,
            "variable1": "/status/##RACK_ID##:AvgCellVoltage",
            "expression": "{1} >= 2.5 and {1} <= 4"
        },
        "FireFaultActive": false
    },
    "/limits/##RACK_ID##": {
        "ChargeCurrentLimit": 0,
        "DischargeCurrentLimit": 0
    }
}