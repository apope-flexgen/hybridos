{
    "/doc/03_pcs_manager": {
        "note1": "This is the power conversion system (PCS) manager config file for Power Electronics (PE)",
        "note1a": "/assets/pcs/##PCS_ID##        - defines the web UI for the PCS. PCS-related statuses, controls, and faults/alarms are displayed on the UI",
        "note1b": "/config/pcs                - defines configurable variables used in the ESS Controller source code",
        "note1c": "/controls/pcs              - defines the control variables for the PCS (ex.: commands to start the PCS, commands to initialize the PCS on system startup, etc.)",
        "note1d": "/status/pcs                - defines the status variables for the PCS",
        "note1e": "/components/[id]           - defines the interface for retrieving data from the PCS hardware and converting the data into a useable format (ex.: scaling, remap, etc.)",
        "note1f": "/links/pcs                 - defines mapping of external interface components to internal variables",
        "note1g": "/vlinks/pcs                - allows two variables to share the same value",
        "note1h": "/sched/pcs                 - defines the variables that will run a function on a scheduled basis",
        "note1i": "/schedule/wake_monitor/pcs - periodically runs a function for a particular variable (default to 100ms; wake_monitor to be removed)",
        "note1j": "/faults/pcs                - defines faults reported by the ESS Controller (will trigger PCS shutdown)",
        "note1k": "/alarms/pcs                - defines alarms reported by the ESS Controller",
        "note2":"To retrieve data from the PCS hardware, the modbus communication protocol will be used. To connect via modbus, use the modbus client (pcs_modbus_client.json)"
    },
    "/config/pcs":{
        "maxKeyCmdOnTime": 3,
        "maxKeyCmdTime": 4,
        "maxKeyCmdTries": 5,
        "maxShutdownTime": 30,
        "maxStartupTime": 30,
        "maxFullStartupTime": 240,
        "RatedApparentPower": 3630,
        "RatedPowerFactor": 0.8,
        "RatedActivePower": 1815,
        "RatedReactivePower": 1560.9,
        "xMaxActivePowerSetpoint": 1815,
        "RatedNumModules": 6,
        "WatchdogTimeoutConfig": 60,
        "WatchdogResetRefsTimeConfig": 4,
        "AlarmDestination": "/assets/pcs/##PCS_ID##:alarms",
        "FaultDestination": "/assets/pcs/##PCS_ID##:faults",
        "NoFaultMsg": "(NOFLTS) No faults",
        "NoAlarmMsg": "(NOWRN) No warnings",
        "enable": false,
        "enum_opt": false
    },
    "/assets/pcs/##PCS_ID##": {
        "name":"PE PCS Manager",
        "alarms":                        { "name": "Alarms",                       "value": 0,        "enabled": true, "options": [] },
        "faults":                        { "name": "Faults",                       "value": 0,        "enabled": true, "options": [] },
        "status":                        { "name": "Status",                       "value": "INIT",   "enabled": true  },
        "work_mode":                     { "name": "Work Mode",                    "value": "INIT",   "enabled": true  },
        "on_grid_mode_status":           { "name": "On-grid Mode",                 "value": "INIT",   "enabled": true  },
        "charge_discharge_status":       { "name": "Charge/Discharge Status",      "value": "INIT",   "enabled": true  },
        "status_gen_switch":             { "name": "Status Gen. Switch",           "value": "INIT",   "enabled": true  },
        "com_status":                    { "name": "Communication Status",         "value": "INIT",   "enabled": true  },
        "active_power":                  { "name": "Active Power",                 "value": 17,       "enabled": true  },
        "reactive_power":                { "name": "Reactive Power",               "value": 17.200,   "enabled": true  },
        "apparent_power":                { "name": "Apparent Power",               "value": 1.299999, "enabled": true  },
        "power_factor":                  { "name": "Power Factor",                 "value": 0,        "enabled": true  },
        "active_power_command":          { "name": "Active Power Command",         "value": 3.099999, "enabled": true  },
        "reactive_power_command":        { "name": "Reactive Power Command",       "value": 0,        "enabled": true  },
        "frequency_command":             { "name": "Frequency Command",            "value": 0,        "enabled": true  },
        "voltage_command":               { "name": "Voltage Command",              "value": 0,        "enabled": true  },
        "voltage_l1_l2":                 { "name": "L1-L2 AC Voltage",             "value": 573.599,  "enabled": true  },
        "voltage_l2_l3":                 { "name": "L2-L3 AC Voltage",             "value": 573.5999, "enabled": true  },
        "voltage_l3_l1":                 { "name": "L3-L1 AC Voltage",             "value": 570.7999, "enabled": true  },
        "voltage_l1_l2_lv":              { "name": "L1-L2 AC Voltage LV",          "value": 573.599,  "enabled": true  },
        "voltage_l2_l3_lv":              { "name": "L2-L3 AC Voltage LV",          "value": 573.5999, "enabled": true  },
        "voltage_l3_l1_lv":              { "name": "L3-L1 AC Voltage LV",          "value": 570.7999, "enabled": true  },
        "current_l1":                    { "name": "L1 AC Current",                "value": 40.78,    "enabled": true  },
        "current_l2":                    { "name": "L2 AC Current",                "value": 41.200,   "enabled": true  },
        "current_l3":                    { "name": "L3 AC Current",                "value": 40,       "enabled": true  },
        "frequency":                     { "name": "Frequency",                    "value": 59.970,   "enabled": true  },
        "power_dc":                      { "name": "DC Power",                     "value": 0,        "enabled": true  },
        "voltage_dc":                    { "name": "DC Voltage",                   "value": 1069.800, "enabled": true  },
        "current_dc":                    { "name": "DC Current",                   "value": 0,        "enabled": true  },
        "max_active_power":              { "name": "Max Active Power",             "value": 0,        "enabled": true  },
        "max_charge_power":              { "name": "Max Charge Power",             "value": 0,        "enabled": true  },
        "max_discharge_power":           { "name": "Max Discharge Power",          "value": 0,        "enabled": true  },
        "daily_energy_delivered":        { "name": "Daily Energy Delivered",       "value": 0,        "enabled": true  },
        "daily_energy_consumed":         { "name": "Daily Energy Consumed",        "value": 0,        "enabled": true  },
        "total_energy_delivered":        { "name": "Total Energy Delivered",       "value": 0,        "enabled": true  },
        "total_energy_consumed":         { "name": "Total Energy Consumed",        "value": 0,        "enabled": true  },
        "num_running_modules":           { "name": "Modules Running",              "value": 0,        "enabled": false },
        "maint_active_power_setpoint":   { "name": "Active Power Setpoint (kW)",   "value": 0,        "enabled": false },
        "maint_reactive_power_setpoint": { "name": "Reactive Power Setpoint (kW)", "value": 0,        "enabled": false },
        "maint_mode": {
            "name": "Maintenance Mode",
            "value": false,
            "enabled": true,
            "actions": {
                "onSet": [{
                    "func": [
                        {"ifChanged": false, "func": "LogInfo", "amap": "##ESS_ID##"}
                    ],
                    "remap": [
                        {"inValue": true, "ifChanged": false,  "uri": "/assets/pcs/##PCS_ID##:clear_faults@enabled"},
                        {"inValue": true, "ifChanged": false,  "uri": "/assets/pcs/##PCS_ID##:maint_active_power_setpoint@enabled"},
                        {"inValue": true, "ifChanged": false,  "uri": "/assets/pcs/##PCS_ID##:maint_reactive_power_setpoint@enabled"}
                    ]
                }]
            },

            "options": [
                {"name": "No", "return_value": false},
                {"name": "Yes","return_value": true}
            ]
        },

        "start": {
            "name": "Start",
            "note": "UI control variable for running the PCS. We'll either start the PCS from off or standby, depending on the current state",
            "value": false,
            "enabled": false,
            "actions": {
                "onSet": [{
                    "remap": [
                        {"inValue": true, "ifChanged": false, "uri": "/controls/pcs:SelectStartMode",    "outValue": 0}
                    ],
                    "func": [
                        {"ifChanged": false, "func": "LogInfo",      "amap": "##ESS_ID##"},
                        {"ifChanged": false, "func": "CalculateVar", "amap": "pcs",         "inAv": "/controls/pcs:SelectStartMode"}    
                    ]
                }]
            },
            "options": [
                {"name": "No", "return_value": false},
                {"name": "Yes","return_value": true}
            ]
        },
        "standby": {
            "name": "Standby",
            "note": "UI control variable for putting the PCS in standby. 0 kW and 0 kVAr power commands are sent to the PCS and then the standby command routine is triggered",
            "value": false,
            "enabled": false,
            "actions": {
                "onSet": [{
                    "func": [
                        {"ifChanged": false, "func": "LogInfo", "amap": "##ESS_ID##"}
                    ],
                    "remap": [
                        {"inValue": true, "ifChanged": false, "uri": "/controls/pcs:UncorrectedActivePowerSetpoint",   "outValue": 0},
                        {"inValue": true, "ifChanged": false, "uri": "/controls/pcs:ReactivePowerSetpoint", "outValue": 0},
                        {"inValue": true, "ifChanged": false, "uri": "/external/pcs:UncorrectedActivePowerSetpoint",     "outValue": 0, "fims": "set", "note": "Broadcast 0 kW command to other ESS's"},
                        {"inValue": true, "ifChanged": false, "uri": "/external/pcs:ReactivePowerSetpoint",   "outValue": 0, "fims": "set", "note": "Broadcast 0 kVAr command to other ESS's"},
                        {"inValue": true, "ifChanged": false, "uri": "/controls/pcs:Standby@triggerCmd",    "outValue": true},
                        {"inValue": true, "ifChanged": false, "uri": "/controls/pcs:Standby",               "outValue": 1}
                    ]
                }]
            },
            "options": [
                {"name": "No", "return_value": false},
                {"name": "Yes","return_value": true}
            ]
        },

        "shutdown": {
            "name": "Shutdown",
            "note": "UI control variable for shutting down the PCS. 0 kW and 0 kVAr power commands are sent to the PCS and then the shutdown command routine is triggered",
            "value": false,
            "enabled": true,
            "actions": {
                "onSet": [{
                    "remap": [
                        {"inValue": true, "ifChanged": false, "uri": "/controls/pcs:UncorrectedActivePowerSetpoint",   "outValue": 0},
                        {"inValue": true, "ifChanged": false, "uri": "/controls/pcs:ReactivePowerSetpoint", "outValue": 0},
                        {"inValue": true, "ifChanged": false, "uri": "/external/pcs:UncorrectedActivePowerSetpoint",   "outValue": 0, "fims": "set", "note": "Broadcast 0 kW command to other ESS's"},
                        {"inValue": true, "ifChanged": false, "uri": "/external/pcs:ReactivePowerSetpoint", "outValue": 0, "fims": "set", "note": "Broadcast 0 kVAr command to other ESS's"},
                        {"inValue": true, "ifChanged": false, "uri": "/controls/pcs:SelectShutdownMode",    "outValue": 0}
                    ],
                    "func": [
                        {"ifChanged": false, "func": "LogInfo",      "amap": "##ESS_ID##"},
                        {"ifChanged": false, "func": "CalculateVar", "amap": "pcs",         "inAv": "/controls/pcs:SelectShutdownMode"}   
                    ]
                }]
            },
            "options": [
                {"name": "No", "return_value": false},
                {"name": "Yes","return_value": true}
            ]
        },
        "clear_faults": {
            "name": "Clear Faults",
            "value": false,
            "enabled": false,
            "actions": {
                "onSet": [{
                    "func": [
                        {"ifChanged": false, "func": "LogInfo", "amap": "##ESS_ID##"}
                    ],
                    "remap": [
                        {"ifChanged": false, "uri": "/controls/pcs:ClearFaults@triggerCmd", "outValue": true},
                        {"ifChanged": false, "uri": "/controls/pcs:ClearFaults",            "outValue": 1, "note": "Send clear faults command to PCS"}
                    ]
                }]
            },
            "options": [
                {"name": "Clear Faults", "return_value": "Clear"}
            ]
        },
        "active_power_gradient": {
            "name": "Active Power Ramp Rate (%/s)",
            "value": 10,
            "enabled": false,
            "actions": {
                "onSet": [{
                    "remap":[
                        {"fims": "set", "uri": "/components/pe_pcs_controls:rise_grad_p"},
                        {"fims": "set", "uri": "/components/pe_pcs_controls:drop_grad_p"},
                        {"fims": "set", "uri": "/components/pe_pcs_controls:start_grad_p"},
                        {"fims": "set", "uri": "/components/pe_pcs_controls:stop_grad_p"}
                    ]
                }]
            },
            "options": []
        },
        "reactive_power_gradient": {
            "name": "Reactive Power Ramp Rate (%/s)",
            "value": 10,
            "enabled": false,
            "actions": {
                "onSet": [{
                    "remap":[
                        {"fims": "set", "uri": "/components/pe_pcs_controls:rise_grad_q"},
                        {"fims": "set", "uri": "/components/pe_pcs_controls:drop_grad_q"},
                        {"fims": "set", "uri": "/components/pe_pcs_controls:start_grad_q"},
                        {"fims": "set", "uri": "/components/pe_pcs_controls:stop_grad_q"}
                    ]
                }]
            },
            "options": []
        },
        "e-stop": {
            "name": "Emergency Stop",
            "note": "UI control variable for shutting down the PCS using estop. 0 kW and 0 kVAr power commands are sent to the PCS and then the estop command routine is triggered",
            "value": false,
            "enabled": true,
            "actions":	{
                "onSet":	[{
                    "remap":	[
                        {"inValue": true, "ifChanged": false, "uri": "/controls/pcs:UncorrectedActivePowerSetpoint",   "outValue": 0},
                        {"inValue": true, "ifChanged": false, "uri": "/controls/pcs:ReactivePowerSetpoint", "outValue": 0},
                        {"inValue": true, "ifChanged": false, "uri": "/external/pcs:UncorrectedActivePowerSetpoint",   "outValue": 0, "fims": "set", "note": "Broadcast 0 kW command to other ESS's"},
                        {"inValue": true, "ifChanged": false, "uri": "/external/pcs:ReactivePowerSetpoint", "outValue": 0, "fims": "set", "note": "Broadcast 0 kVAr command to other ESS's"},
                        {"inValue": true, "ifChanged": false, "uri": "/controls/pcs:EStop@triggerCmd",      "outValue": true},
                        {"inValue": true, "ifChanged": false, "uri": "/controls/pcs:EStop",                 "outValue": 1}
                    ]
                }]
            },
            "options": [
                {"name": "No", "return_value": false},
                {"name": "Yes","return_value": true}
            ]
        }
    },
    "/schedule/wake_monitor/pcs":{
        "/status/pcs:StartEnable":                { "enable": true, "amap": "pcs", "func":"CalculateVar"},
        "/status/pcs:ShutdownEnable":             { "enable": true, "amap": "pcs", "func":"CalculateVar"},
        "/status/pcs:StandbyEnable":              { "enable": true, "amap": "pcs", "func":"CalculateVar"},

        "/status/pcs:DailyActiveEnergyGenerated": { "enable": true, "amap": "pcs", "func":"CalculateVar"},
        "/status/pcs:TotalActiveEnergyGenerated": { "enable": true, "amap": "pcs", "func":"CalculateVar"},
        "/status/pcs:DailyActiveEnergyConsumed":  { "enable": true, "amap": "pcs", "func":"CalculateVar"},
        "/status/pcs:TotalActiveEnergyConsumed":  { "enable": true, "amap": "pcs", "func":"CalculateVar"},

        "/status/pcs:TotalActivePower":           { "enable": true, "amap": "pcs", "func":"CalculateVar"},
        "/status/pcs:TotalReactivePower":         { "enable": true, "amap": "pcs", "func":"CalculateVar"},
        "/status/pcs:TotalApparentPower":         { "enable": true, "amap": "pcs", "func":"CalculateVar"},
        "/status/pcs:AverageLineVoltage":         { "enable": true, "amap": "pcs", "func":"CalculateVar"},
        "/status/pcs:TotalRunningModules":        { "enable": true, "amap": "pcs", "func":"CalculateVar"},
        "/status/pcs:TotalCurrentL1":             { "enable": true, "amap": "pcs", "func":"CalculateVar"},
        "/status/pcs:TotalCurrentL2":             { "enable": true, "amap": "pcs", "func":"CalculateVar"},
        "/status/pcs:TotalCurrentL3":             { "enable": true, "amap": "pcs", "func":"CalculateVar"},
        "/status/pcs:PowerDC":                    { "enable": true, "amap": "pcs", "func":"CalculateVar"},
        "/status/pcs:PCSFaultCnt":                { "enable": true, "amap": "pcs", "func":"CalculateVar"},
        "/status/pcs:IsFaulted":                  { "enable": true, "amap": "pcs", "func":"CalculateVar"}
    },

    "/system/commands": {
        "runPCSOpts": {
            "value": false,
            "enabled": false,
            "targav": "/system/commands:run",
            "options": [
                {"uri":"/sched/pcs:pubAssets_pcs",     "aname":"pcs", "value":0, "every":1},
                {"uri":"/sched/pcs:runMonitor_pcs",    "aname":"pcs", "value":0, "every":0.1}
            ],
            "actions": {
                "onSet":[{"func":[{"amap": "pcs", "func":"SchedItemOpts"}]}]
            }
        }
    },

    "/sched/pcs": {
        "pubAssets_pcs": {
            "value": 0,
            "enable": "/config/pcs:enable",
            "mode": "ui",
            "table": "/assets/pcs/##PCS_ID##",
            "actions": {
                "onSet":[{"func":[{"amap": "pcs", "func":"RunPub"}]}]
            }
        },
        "runMonitor_pcs":{
            "value":1,
            "enable": "/config/pcs:enable",
            "monitor":"wake_monitor",
            "aname":"pcs",
            "actions":{
                "onSet":[{"func":[{"amap": "pcs", "func":"RunMonitor"}]}]
            }
        }
    },

    "/vlinks/pcs": {
        "ui_status":                     {"value": "/assets/pcs/##PCS_ID##:status",                        "vlink": "/status/pcs:Status"},
        "ui_active_power":               {"value": "/assets/pcs/##PCS_ID##:active_power",                  "vlink": "/status/pcs:TotalActivePower"},
        "ui_reactive_power":             {"value": "/assets/pcs/##PCS_ID##:reactive_power",                "vlink": "/status/pcs:TotalReactivePower"},
        "ui_apparent_power":             {"value": "/assets/pcs/##PCS_ID##:apparent_power",                "vlink": "/status/pcs:TotalApparentPower"},
        "ui_voltage_l1_l2":              {"value": "/assets/pcs/##PCS_ID##:voltage_l1_l2",                 "vlink": "/status/pcs:VoltageL1L2"},
        "ui_voltage_l2_l3":              {"value": "/assets/pcs/##PCS_ID##:voltage_l2_l3",                 "vlink": "/status/pcs:VoltageL2L3"},
        "ui_voltage_l3_l1":              {"value": "/assets/pcs/##PCS_ID##:voltage_l3_l1",                 "vlink": "/status/pcs:VoltageL3L1"},
        "ui_voltage_l1_l2_lv":           {"value": "/assets/pcs/##PCS_ID##:voltage_l1_l2_lv",              "vlink": "/status/pcs:VoltageL1L2_lv"},
        "ui_voltage_l2_l3_lv":           {"value": "/assets/pcs/##PCS_ID##:voltage_l2_l3_lv",              "vlink": "/status/pcs:VoltageL2L3_lv"},
        "ui_voltage_l3_l1_lv":           {"value": "/assets/pcs/##PCS_ID##:voltage_l3_l1_lv",              "vlink": "/status/pcs:VoltageL3L1_lv"},
        "ui_current_l1":                 {"value": "/assets/pcs/##PCS_ID##:current_l1",                    "vlink": "/status/pcs:TotalCurrentL1"},
        "ui_current_l2":                 {"value": "/assets/pcs/##PCS_ID##:current_l2",                    "vlink": "/status/pcs:TotalCurrentL2"},
        "ui_current_l3":                 {"value": "/assets/pcs/##PCS_ID##:current_l3",                    "vlink": "/status/pcs:TotalCurrentL3"},
        "ui_frequency":                  {"value": "/assets/pcs/##PCS_ID##:frequency",                     "vlink": "/status/pcs:Frequency"},
        "ui_power_dc":                   {"value": "/assets/pcs/##PCS_ID##:power_dc",                      "vlink": "/status/pcs:PowerDC"},
        "ui_voltage_dc":                 {"value": "/assets/pcs/##PCS_ID##:voltage_dc",                    "vlink": "/status/pcs:VoltageDC"},
        "ui_current_dc":                 {"value": "/assets/pcs/##PCS_ID##:current_dc",                    "vlink": "/status/pcs:CurrentDC"},
        "ui_pf":                         {"value": "/assets/pcs/##PCS_ID##:power_factor",                  "vlink": "/status/pcs:PowerFactor"},
        "ui_active_power_cmd":           {"value": "/assets/pcs/##PCS_ID##:active_power_command",          "vlink": "/controls/pcs:ActivePowerCmdReal"},
        "ui_reactive_power_cmd":         {"value": "/assets/pcs/##PCS_ID##:reactive_power_command",        "vlink": "/controls/pcs:ReactivePowerCmdReal"},
        "ui_num_running_modules":        {"value": "/assets/pcs/##PCS_ID##:num_running_modules",           "vlink": "/status/pcs:NumRunningModules"},
        "ui_max_active_power":           {"value": "/assets/pcs/##PCS_ID##:max_active_power",              "vlink": "/limits/pcs:RatedActivePower"},
        "ui_max_charge_power":           {"value": "/assets/pcs/##PCS_ID##:max_charge_power",              "vlink": "/limits/pcs:MaxPCSChargePower"},
        "ui_max_discharge_power":        {"value": "/assets/pcs/##PCS_ID##:max_discharge_power",           "vlink": "/limits/pcs:MaxPCSDischargePower"},
        "ui_daily_energy_delivered":     {"value": "/assets/pcs/##PCS_ID##:daily_energy_delivered",        "vlink": "/status/pcs:DailyActiveEnergyGenerated"},
        "ui_daily_energy_consumed":      {"value": "/assets/pcs/##PCS_ID##:daily_energy_consumed",         "vlink": "/status/pcs:DailyActiveEnergyConsumed"},
        "ui_total_energy_delivered":     {"value": "/assets/pcs/##PCS_ID##:total_energy_delivered",        "vlink": "/status/pcs:TotalActiveEnergyGenerated"},
        "ui_total_energy_consumed":      {"value": "/assets/pcs/##PCS_ID##:total_energy_consumed",         "vlink": "/status/pcs:TotalActiveEnergyConsumed"},
		
        "maint_active_power_setpoint":   {"value": "/assets/pcs/##PCS_ID##:maint_active_power_setpoint",   "vlink": "/controls/pcs:UncorrectedActivePowerSetpoint"},
        "maint_reactive_power_setpoint": {"value": "/assets/pcs/##PCS_ID##:maint_reactive_power_setpoint", "vlink": "/controls/pcs:ReactivePowerSetpoint"},
        "p_gradient":                    {"value": "/assets/pcs/##PCS_ID##:active_power_gradient",         "vlink": "/controls/pcs:RiseGradientP"},
        "q_gradient":                    {"value": "/assets/pcs/##PCS_ID##:reactive_power_gradient",       "vlink": "/controls/pcs:RiseGradientQ"},

        "site_status":                   { "value": "/master/##ESS_ID##_ls:pcs_status",                      "vlink": "/status/pcs:Status"},
        "site_active_power":             { "value": "/master/##ESS_ID##_ls:active_power",                    "vlink": "/status/pcs:TotalActivePower"},
        "site_reactive_power":           { "value": "/master/##ESS_ID##_ls:reactive_power",                  "vlink": "/status/pcs:TotalReactivePower"},
        "site_apparent_power":           { "value": "/master/##ESS_ID##_ls:apparent_power",                  "vlink": "/status/pcs:TotalApparentPower"},
        "site_voltage_l1_l2":            { "value": "/master/##ESS_ID##_ls:voltage_l1_l2",                   "vlink": "/status/pcs:VoltageL1L2"},
        "site_voltage_l2_l3":            { "value": "/master/##ESS_ID##_ls:voltage_l2_l3",                   "vlink": "/status/pcs:VoltageL2L3"},
        "site_voltage_l3_l1":            { "value": "/master/##ESS_ID##_ls:voltage_l3_l1",                   "vlink": "/status/pcs:VoltageL3L1"},
        "site_voltage_l1_l2_lv":         { "value": "/master/##ESS_ID##_ls:voltage_l1_l2_lv",                "vlink": "/status/pcs:VoltageL1L2_lv"},
        "site_voltage_l2_l3_lv":         { "value": "/master/##ESS_ID##_ls:voltage_l2_l3_lv",                "vlink": "/status/pcs:VoltageL2L3_lv"},
        "site_voltage_l3_l1_lv":         { "value": "/master/##ESS_ID##_ls:voltage_l3_l1_lv",                "vlink": "/status/pcs:VoltageL3L1_lv"},
        "site_current_l1":               { "value": "/master/##ESS_ID##_ls:current_l1",                      "vlink": "/status/pcs:TotalCurrentL1"},
        "site_current_l2":               { "value": "/master/##ESS_ID##_ls:current_l2",                      "vlink": "/status/pcs:TotalCurrentL2"},
        "site_current_l3":               { "value": "/master/##ESS_ID##_ls:current_l3",                      "vlink": "/status/pcs:TotalCurrentL3"},
        "site_frequency":                { "value": "/master/##ESS_ID##_ls:frequency",                       "vlink": "/status/pcs:Frequency"},
        "site_pf":                       { "value": "/master/##ESS_ID##_ls:pf",                              "vlink": "/status/pcs:PowerFactor"},
        "site_num_running_modules":      { "value": "/master/##ESS_ID##_ls:pcs_modules_in_service",          "vlink": "/status/pcs:NumRunningModules"},
        "pcs1_site_power_dc":            { "value": "/master/##ESS_ID##_ls:pcs_power_dc",                    "vlink": "/status/pcs:PowerDC"},
        "pcs1_site_voltage_dc":          { "value": "/master/##ESS_ID##_ls:pcs_voltage_dc",                  "vlink": "/status/pcs:VoltageDC"},
        "pcs1_site_current_dc":          { "value": "/master/##ESS_ID##_ls:pcs_current_dc",                  "vlink": "/status/pcs:CurrentDC"},
        "site_pcs_fault_active":         { "value": "/master/##ESS_ID##_ls:pcs_fault_active",                "vlink": "/status/pcs:IsFaulted"},
        "site_avg_line_voltage":         { "value": "/master/##ESS_ID##_ls:average_line_voltage",            "vlink": "/status/pcs:AverageLineVoltage"},
        "site_max_active_power":         { "value": "/master/##ESS_ID##_ls:pcs_max_active_power",            "vlink": "/limits/pcs:RatedActivePower"},
        "site_max_charge_power":         { "value": "/master/##ESS_ID##_ls:pcs_max_charge_power",            "vlink": "/limits/pcs:MaxPCSChargePower"},
        "site_max_discharge_power":      { "value": "/master/##ESS_ID##_ls:pcs_max_discharge_power",         "vlink": "/limits/pcs:MaxPCSDischargePower"}
    },

    "/status/pcs": {
        "note": "These are component status vars",
        "Status": "N/A",
        "dc_contactor_open": true,
        "ac_contactor_open": true,
        "SendClearFault": false,
        "SystemFault": false,
        "SystemStandby": false,
        "FaultShutdown": {
            "value": false,
            "note": "When the ESS faults, we'll shutdown the PCS",
            "ifChanged": true,
            "actions": { 
                "onSet":[{
                    "remap": [
                        {"uri": "/master/##ESS_ID##_ls:fault_shutdown", "note": "Pass fault shutdown state up to ESS Controller main"}
                    ],
                    "func": [
                        {"func": "LogInfo", "amap": "##ESS_ID##"}
                    ]
                }]
            }
        },
        "HardShutdown": false,
        "FullShutdown": false,
        "SoftStartup": false,
        "FullStartup": false,
        "PCSStatusResp": {
            "value": "Initialization",
            "ifChanged": true,
            "actions":	{
                "onSet":	[{
                    "func": [
                        {
                            "func": "LogInfo",
                            "amap": "##ESS_ID##"
                        }
                    ]
                }
            ]}
        },
        "SystemState": {
            "value": "N/A",
            "actions": {
                "onSet": [{
                    "remap": [
                        {"inValue": "Off",      "uri": "/status/pcs:DCClosed", "outValue": 0},
                        {"inValue": "Starting", "uri": "/status/pcs:DCClosed", "outValue": 0},
                        {"inValue": "Ready",    "uri": "/status/pcs:DCClosed", "outValue": 1},
                        {"inValue": "Running",  "uri": "/status/pcs:DCClosed", "outValue": 1},
                        {"inValue": "Shutdown", "uri": "/status/pcs:DCClosed", "outValue": 1},
                        {"inValue": "Fault",    "uri": "/status/pcs:DCClosed", "outValue": 0},
                        
                        {"inValue": "Off",      "uri": "/status/pcs:NumRunningModules@EnableMinValCheck", "outValue": false},
                        {"inValue": "Starting", "uri": "/status/pcs:NumRunningModules@EnableMinValCheck", "outValue": false},
                        {"inValue": "Ready",    "uri": "/status/pcs:NumRunningModules@EnableMinValCheck", "outValue": false},
                        {"inValue": "Running",  "uri": "/status/pcs:NumRunningModules@EnableMinValCheck", "outValue": true},
                        {"inValue": "Shutdown", "uri": "/status/pcs:NumRunningModules@EnableMinValCheck", "outValue": false},
                        {"inValue": "Fault",    "uri": "/status/pcs:NumRunningModules@EnableMinValCheck", "outValue": false},

                        {"inValue": "Off",      "uri": "/master/##ESS_ID##_ls:system_state", "outValue": 1,  "note": "Bit 0 - Stop"},
                        {"inValue": "Shutdown", "uri": "/master/##ESS_ID##_ls:system_state", "outValue": 1,  "note": "Bit 0 - Stop"},
                        {"inValue": "Running",  "uri": "/master/##ESS_ID##_ls:system_state", "outValue": 2,  "note": "Bit 1 - Run"},
                        {"inValue": "Fault",    "uri": "/master/##ESS_ID##_ls:system_state", "outValue": 4,  "note": "Bit 2 - Fault"},
                        {"inValue": "Ready",    "uri": "/master/##ESS_ID##_ls:system_state", "outValue": 8,  "note": "Bit 3 - Standby"},

                        {"inValue": "Off",      "uri": "/master/##ESS_ID##_ls:pcs_running", "outValue": false},
                        {"inValue": "Shutdown", "uri": "/master/##ESS_ID##_ls:pcs_running", "outValue": false},
                        {"inValue": "Running",  "uri": "/master/##ESS_ID##_ls:pcs_running", "outValue": true},
                        {"inValue": "Fault",    "uri": "/master/##ESS_ID##_ls:pcs_running", "outValue": false},
                        {"inValue": "Ready",    "uri": "/master/##ESS_ID##_ls:pcs_running", "outValue": false},

                        {"inValue": "Off",      "uri": "/status/pcs:SystemFault", "outValue": false},
                        {"inValue": "Starting", "uri": "/status/pcs:SystemFault", "outValue": false},
                        {"inValue": "Ready",    "uri": "/status/pcs:SystemFault", "outValue": false},
                        {"inValue": "Running",  "uri": "/status/pcs:SystemFault", "outValue": false},
                        {"inValue": "Shutdown", "uri": "/status/pcs:SystemFault", "outValue": false},
                        {"inValue": "Fault",    "uri": "/status/pcs:SystemFault", "outValue": true},

                        {"uri": "/master/##ESS_ID##_ls:system_state_string"}
                    ]
                }
            ]}
        },
        "DCClosed": {
            "value": 0,
            "resetChange": false,
            "actions": {
                "onSet": [{
                    "remap": [
                        {"inValue": 0, "uri": "/status/pcs:VoltageDC@EnableMinValCheck", "outValue": false},
                        {"inValue": 1, "uri": "/status/pcs:VoltageDC@EnableMinValCheck", "outValue": true},
                        
                        {"inValue": 0, "uri": "/status/bms:Voltage@EnableMinValCheck", "outValue": false},
                        {"inValue": 1, "uri": "/status/bms:Voltage@EnableMinValCheck", "outValue": true}
                    ]
                }]
            }
        },
        "StartEnable": {
            "value": 0,
            "note": "Enable the start PCS UI control variable if the BMS DC contactors are closed, the PCS is in maintenance mode, and the PCS is either off or in standby",
            "useExpr": true,
            "numVars": 4,
            "variable1": "/status/bms:DCClosed",
            "variable2": "/external/bms:DCClosed",
            "variable3": "/assets/pcs/##PCS_ID##:maint_mode",
            "variable4": "/status/pcs:SystemState",
            "expression": "{1} and {2} and {3} and ({4} == Off or {4} == Ready)",
            "actions": {
                "onSet": [{
                    "remap": [
                        {"inValue":0, "uri":"/assets/pcs/##PCS_ID##:start@enabled", "outValue":false},
                        {"inValue":1, "uri":"/assets/pcs/##PCS_ID##:start@enabled", "outValue":true},

                        {"inValue":0, "uri":"/master/##ESS_ID##_ls:pcs_start_enabled", "outValue":false},
                        {"inValue":1, "uri":"/master/##ESS_ID##_ls:pcs_start_enabled", "outValue":true}
                    ]
                }]
            }
        },
        "ShutdownEnable": {
            "value": 0,
            "note": "Enable the shutdown PCS UI control variable if the PCS is in maintenance mode and the PCS is either running, starting, or in standby",
            "useExpr": true,
            "numVars": 2,
            "variable1": "/assets/pcs/##PCS_ID##:maint_mode",
            "variable2": "/status/pcs:SystemState",
            "expression": "{1} and ({2} == Running or {2} == Ready or {2} == Starting)",
            "actions": {
                "onSet": [{
                    "remap": [
                        {"inValue":0, "uri":"/assets/pcs/##PCS_ID##:shutdown@enabled", "outValue":false},
                        {"inValue":1, "uri":"/assets/pcs/##PCS_ID##:shutdown@enabled", "outValue":true},

                        {"inValue":0, "uri":"/master/##ESS_ID##_ls:pcs_shutdown_enabled", "outValue":false},
                        {"inValue":1, "uri":"/master/##ESS_ID##_ls:pcs_shutdown_enabled", "outValue":true}
                    ]
                }]
            }
        },
        "StandbyEnable": {
            "value": 0,
            "note": "Enable the standby PCS UI control variable if the BMS DC contactors are closed, the PCS is in maintenance mode, the PCS is running, and the PCS is in grid-following (on-grid) mode",
            "useExpr": true,
            "numVars": 4,
            "variable1": "/status/bms:DCClosed",
            "variable2": "/external/bms:DCClosed",
            "variable3": "/assets/pcs/##PCS_ID##:maint_mode",
            "variable4": "/status/pcs:SystemState",
            "expression": "{1} and {2} and {3} and {4} == Running",
            "actions": {
                "onSet": [{
                    "remap": [
                        {"inValue":0, "uri":"/assets/pcs/##PCS_ID##:standby@enabled", "outValue":false},
                        {"inValue":1, "uri":"/assets/pcs/##PCS_ID##:standby@enabled", "outValue":true}
                    ]
                }]
            }
        },
        "PCSResetKeyCmd": 0,
        "CommsOK": {
            "value": false,
            "actions": {
                "onSet":[{
                    "remap":[
                        { "inValue": true, "uri": "/assets/pcs/##PCS_ID##:com_status",      "outValue": "ONLINE"},
                        { "inValue": false, "uri": "/assets/pcs/##PCS_ID##:com_status",     "outValue": "OFFLINE"},

                        {"uri": "/master/##ESS_ID##_ls:pcs_comms_ok"}
                    ]
                }]
            }
        },
        "SystemFaultCleared": {
            "value": false,
            "ifChanged": false,
            "actions": {
                "onSet":[{
                    "remap":[
                        {"inValue": true, "ifChanged": false, "outValue": "Clear", "uri":"/faults/pcs:clear_faults"},
                        {"inValue": true, "ifChanged": false, "outValue": "Clear", "uri":"/alarms/pcs:clear_alarms"},

                        {"inValue": true, "ifChanged": false, "outValue": false, "uri": "/master/##ESS_ID##_ls:com_status"},
                        {"inValue": true, "ifChanged": false, "outValue": 0, "uri": "/master/##ESS_ID##_ls:pcs1_faults1"},
                        {"inValue": true, "ifChanged": false, "outValue": 0, "uri": "/master/##ESS_ID##_ls:pcs1_faults2"},
                        {"inValue": true, "ifChanged": false, "outValue": 0, "uri": "/master/##ESS_ID##_ls:pcs1_faults3"},
                        {"inValue": true, "ifChanged": false, "outValue": 0, "uri": "/master/##ESS_ID##_ls:pcs1_faults4"},
                        {"inValue": true, "ifChanged": false, "outValue": 0, "uri": "/master/##ESS_ID##_ls:pcs1_alarms1"},
                        {"inValue": true, "ifChanged": false, "outValue": 0, "uri": "/master/##ESS_ID##_ls:pcs1_alarms2"},
                        {"inValue": true, "ifChanged": false, "outValue": 0, "uri": "/master/##ESS_ID##_ls:pcs1_alarms3"},
                        {"inValue": true, "ifChanged": false, "outValue": 0, "uri": "/master/##ESS_ID##_ls:pcs1_alarms4"}
                    ]
                }]
            }
        },
        "FaultCnt": 0,
        "PCSFaultCnt": {
            "value": 0,
            "numVars": 2,
            "variable1": "pcs:FaultCnt", 
            "variable2": "/status/pcs:FaultCnt",
            "operation": "+"
        },
        "AlarmCnt": 0,
        "IsFaulted": {
            "value": false,
            "useExpr": true,
            "numVars": 2,
            "variable1": "/status/pcs:SystemFault",
            "variable2": "/status/pcs:PCSFaultCnt",
            "expression": "{1} or {2} > 0"
        },
        "DailyActiveEnergyGenerated": {
            "value": 0,
            "useExpr": true,
            "numVars": 2,
            "variable1": "/components/pe_pcs_info:daily_energy_msb",
            "variable2": "/components/pe_pcs_info:daily_energy_lsb",
            "expression": "{1} * 2 ** 16 + {2}"
        },
        "TotalActiveEnergyGenerated": {
            "value": 0,
            "useExpr": true,
            "numVars": 2,
            "variable1": "/components/pe_pcs_info:total_energy_msb",
            "variable2": "/components/pe_pcs_info:total_energy_lsb",
            "expression": "{1} * 2 ** 16 + {2}"
        },
        "DailyActiveEnergyConsumed": {
            "value": 0,
            "useExpr": true,
            "numVars": 2,
            "variable1": "/components/pe_pcs_info:consum_daily_energy_msb",
            "variable2": "/components/pe_pcs_info:consum_daily_energy_lsb",
            "expression": "{1} * 2 ** 16 + {2}"
        },
        "TotalActiveEnergyConsumed": {
            "value": 0,
            "useExpr": true,
            "numVars": 2,
            "variable1": "/components/pe_pcs_info:consum_total_energy_msb",
            "variable2": "/components/pe_pcs_info:consum_total_energy_lsb",
            "expression": "{1} * 2 ** 16 + {2}"
        },
        "TotalRunningModules": {
            "value": 0,
            "numVars": 1,
            "variable1": "pcs:IsRunning",
            "operation": "+",
            "actions": {
                "onSet": [
                    {"remap": [{"uri": "/status/pcs:NumRunningModules"}]}
                ]
            }
        },
        "VoltageDC": 0,
        "CurrentDC": 0,
        "PowerDC": {
            "value": 0,
            "numVars": 2,
            "variable1": "/status/pcs:VoltageDC",
            "variable2": "/status/pcs:CurrentDC",
            "scale": 1000,
            "operation": "*",
            "debug": true
        },
        "TotalActivePower": {
            "value": 0,
            "numVars": 1,
            "variable1": "pcs:ActivePower",
            "operation": "+"
        },
        "TotalReactivePower": {
            "value": 0,
            "numVars": 1,
            "variable1": "pcs:ReactivePower",
            "operation": "+"
        },
        "TotalApparentPower": {
            "value": 0,
            "numVars": 2,
            "variable1": "/status/pcs:TotalActivePower",
            "variable2": "/status/pcs:TotalReactivePower",
            "useExpr": true,
            "expression": "sqrt({1} ** 2 + {2} ** 2)"
        },
        "TotalCurrentL1": {
            "value": 0,
            "numVars": 1,
            "variable1": "pcs:CurrentL1",
            "operation": "+"
        },
        "TotalCurrentL2": {
            "value": 0,
            "numVars": 1,
            "variable1": "pcs:CurrentL2",
            "operation": "+"
        },
        "TotalCurrentL3": {
            "value": 0,
            "numVars": 1,
            "variable1": "pcs:CurrentL3",
            "operation": "+"
        },
        "VoltageL1L2": 0,
        "VoltageL2L3": 0,
        "VoltageL3L1": 0,
        "AverageLineVoltage": {
            "value": 0,
            "numVars": 3,
            "variable1": "/status/pcs:VoltageL1L2",
            "variable2": "/status/pcs:VoltageL2L3",
            "variable3": "/status/pcs:VoltageL3L1",
            "useExpr": true,
            "expression": "({1} + {2} + {3}) / 3"
        }
    },
    "/external/pcs": {
        "ActivePowerSetpoint": {
            "value": 0,
            "note": "When set, this will set the active power setpoint to 0 kW",
            "actions": {
                "onSet": [{
                    "func": [
                        {"ifChanged": false, "func": "LogInfo", "amap": "##ESS_ID##"}
                    ],
                    "remap": [
                        {"ifChanged": false, "uri": "/controls/pcs:UncorrectedActivePowerSetpoint",   "outValue": 0}
                    ]
                }]
            }
        },
        "ReactivePowerSetpoint": {
            "value": 0,
            "note": "When set, this will set the reactive power setpoint to 0 kVAr",
            "actions": {
                "onSet": [{
                    "func": [
                        {"ifChanged": false, "func": "LogInfo", "amap": "##ESS_ID##"}
                    ],
                    "remap": [
                        {"ifChanged": false, "uri": "/controls/pcs:ReactivePowerSetpoint", "outValue": 0}
                    ]
                }]
            }
        }
    },

    "/assets/pcs": {
        "start_grad_p": {
            "value": 10.0,
            "actions": {
                "onSet": [
                    {"limits": [ {"low": 0.1,"high": 3000.0}]},
                    {"remap": [{"bit": 0,"uri": "/components/pe_pcs_controls","var": "start_grad_p"}]}
                ]
            }
        }
    }
}